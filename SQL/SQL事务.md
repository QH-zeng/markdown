# SQL事务

## 事务概念

事务是一种机制、是一种操作序列，它包含了一组数据库操作命令，  

这组命令要么全部执行，要么全部不执行。因此事务是一个不可分割的工作逻辑单元。在数据库系统上执行并发操作时事务是作为最小的控制单元来使用的。这特别适用于多用户同时操作的数据通信系统。

例如：订票、银行、保险公司以及证券交易系统等。

<u>事务执行是一个整体，所有的SQL语句必须全部执行成功，如果其中有一条SQL语句出现异常，则所有的SQL语句都要回滚，整个事务执行失败。</u>





## 操作

1.开启事务：start transaction;

2.回滚：rollback

3.提交：commit



## 事务提交的方式

### 自动提交

一条DML语句回自动提交一次事务，一条sql代码就会提交（mysql是自动提交）

### 手动提交

需要先开启事务：start Transaction，再提交

### 修改事务的默认提交方式

@@autocommit    ---1代表自动提交   0代表手动提交

set @@autocommit =0;    ————有些数据库是默认手动提交Oracle

手动提交后面要加一个commit；





## 事务的四大特征

- **原子性：**一个事务（transaction）中的所有操作，**<u>要么全部完成，要么全部不完成</u>**，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。
- **一致性：****<u>在事务开始之前和事务结束以后，数据库的完整性没有被破坏</u>**。这表示写入的资料必须完全符合所有的预设规则，这包含资料的精确度、串联性以及后续数据库可以自发性地完成预定的工作。
- **隔离性：**数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括读未提交（Read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（Serializable）。
- **持久性：**事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。